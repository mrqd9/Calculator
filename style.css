* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; -webkit-user-select: none; outline: none; }
html, body { margin: 0; height: 100%; overflow: hidden; background: #121212; font-family: 'Segoe UI', Roboto, sans-serif; }
.calc { height: 100dvh; padding: 4px 6px; background: #121212; display: flex; flex-direction: column; gap: 4px; }

/* Action Bar Styling */
.action-bar { display: flex; justify-content: flex-end; gap: 22px; padding: 0 15px; flex-shrink: 0; height: 28px; align-items: center; }

.btn-action { 
  background: transparent; 
  border: none; 
  color: #81c784; 
  padding: 5px; 
  cursor: pointer; 
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.1s ease;
}

.btn-action:active { 
  transform: scale(0.85);
  opacity: 0.7;
}

/* Display Container */
.display-container { flex: 1; min-height: 0; background: #bdc9b6; border-radius: 18px; display: flex; flex-direction: column; box-shadow: inset 0 2px 10px rgba(0,0,0,0.2); overflow: hidden; border: 1px solid rgba(255,255,255,0.1); }
.history { flex: 1; overflow-y: auto; padding: 8px 10px; display: flex; flex-direction: column; gap: 3px; }

/* History Rows */
.h-row { position: relative; display: flex; align-items: center; min-height: 30px; background: rgba(255,255,255,0.3); border-radius: 15px; flex-shrink: 0; transition: all 0.2s ease; border: 1px solid rgba(0,0,0,0.05); }
.h-exp { flex: 0 0 62%; padding: 2px 10px; font-size: 15px; color: #333; text-align: right; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.h-res { flex: 0 0 38%; padding: 2px 15px 2px 5px; font-size: 15px; font-weight: 700; color: #111; text-align: right; overflow: hidden; white-space: nowrap; }
.negative { color: #b71c1c !important; }

/* Swipe & Modal (unchanged from original logic) */
/* Updated Expand View Logic */
.h-row.can-expand.expanded { 
  flex-direction: column; 
  height: auto; 
  padding: 10px 12px; 
  border-radius: 12px; 
  background: rgba(255,255,255,0.5); 
  align-items: flex-end; /* Keeps numbers aligned to the right */
}
.h-row.expanded .h-exp { 
  white-space: normal; 
  text-align: right; /* Changed to right to match calculator feel */
  border-bottom: 1px dashed rgba(0,0,0,0.1); 
  padding-bottom: 6px; 
  flex: none; /* Removes the "equal height" growth */
  width: 100%;
  word-wrap: break-word; /* Ensures long numbers wrap to new lines */
}
.h-row.expanded .h-res { 
  flex: none; /* Prevents the result from stretching vertically */
  padding-top: 6px; 
  white-space: nowrap; /* Result should stay on one line for clarity */
  font-size: 18px; /* Slightly larger for emphasis in expanded mode */
}
.h-row::before { content: "Delete"; position: absolute; inset: 0; background: #d32f2f; color: white; display: flex; align-items: center; justify-content: flex-end; padding-right: 45px; font-weight: 600; opacity: 0; transition: opacity 0.1s ease; border-radius: 15px; z-index: 1; }
.swipe-arrow { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); width: 14px; height: 2px; background: white; opacity: 0; z-index: 2; transition: 0.1s ease; }
.swipe-arrow::after, .swipe-arrow::before { content: ''; position: absolute; left: 0; width: 7px; height: 2px; background: white; transform-origin: left; }
.swipe-arrow::after { transform: rotate(45deg); }
.swipe-arrow::before { transform: rotate(-45deg); }
.h-row.swiping::before, .h-row.swiping .swipe-arrow { opacity: 1; }

.live-preview { 
  padding: 10px; 
  font-size: 20px; 
  font-weight: 600; 
  color: #111; 
  min-height: 40px; 
  background: rgba(0,0,0,0.05); 
  border-top: 1px solid rgba(0,0,0,0.05);
  
  /* CENTERED WRAPPING SETUP */
  display: block;            /* Essential for the caret to follow text flow */
  text-align: center;        /* Centers your typing */
  white-space: pre-wrap;     /* Allows text to wrap to new lines */
  word-wrap: break-word;     /* Prevents long numbers from breaking the layout */
  overflow-y: auto;          /* Scroll vertically if typing gets very long */
  height: auto;
  max-height: 150px; 
}

/* Caret styling to ensure visibility */
.caret { 
  display: inline-block; 
  width: 2px; 
  height: 1.2em; 
  background: #333; 
  margin-left: 2px; 
  vertical-align: middle; 
  animation: blink 1s steps(1) infinite; 
}

/* Total Strip */
.total-strip { display: flex; flex-direction: column; align-items: center; padding: 0 18px 0; flex-shrink: 0; }
.total-content { display: flex; justify-content: space-between; width: 100%; align-items: baseline; }
.total-label { color: #666; font-size: 12px; font-weight: 800; text-transform: uppercase; }
.total-amount { color: #4caf50; font-size: 28px; font-weight: 900; }
.total-divider { width: 100%; height: 1px; margin-top: 1px; background: linear-gradient(90deg, transparent, #444, transparent); }

/* Main Calculator Keys - Redesigned for a "Pretty" Tactile Feel */
.keys { 
  display: grid; 
  grid-template-columns: repeat(4, 1fr); 
  gap: 6px;
  padding: 8px 8px;
  background: #1a1a1a;
  border-radius: 24px 24px 0 0;
}

.btn-key { 
  height: 56px;
  border: 1px solid rgba(255,255,255,0.05); 
  border-radius: 16px; 
  font-size: 26px; 
  font-weight: 700; 
  color: #e0e0e0; 
  background: linear-gradient(145deg, #252525, #1e1e1e); 
  box-shadow: 4px 4px 8px #0d0d0d, -2px -2px 6px rgba(255,255,255,0.02); 
  transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
  cursor: pointer;
  position: relative;
  overflow: hidden;
}

/* Shine effect on keys */
.btn-key::after {
  content: '';
  position: absolute;
  top: 0; left: 0; width: 100%; height: 50%;
  background: linear-gradient(to bottom, rgba(255,255,255,0.05), transparent);
  pointer-events: none;
}

.btn-key:active { 
  transform: scale(0.92); 
  background: #181818;
  box-shadow: inset 4px 4px 8px #000, inset -2px -2px 6px rgba(255,255,255,0.01);
}

/* Color Modifier: Numbers */
.btn-key.num { 
  color: #ffffff;
  background: linear-gradient(145deg, #2a2a2a, #222222); 
}

/* Color Modifier: Operators (Soft Green Glow) */
.btn-key.op { 
  background: linear-gradient(145deg, #2d332d, #252a25);
  color: #a5d6a7; 
  border: 1px solid rgba(129, 199, 132, 0.1);
}

/* Color Modifier: All Clear (Danger Red) */
.btn-key.ac { 
  background: linear-gradient(145deg, #4b1a1a, #3a1515);
  color: #ff8a80;
  border: 1px solid rgba(255, 138, 128, 0.1);
}

/* Color Modifier: Equal Button (Primary Action) */
.btn-key.eq { 
  grid-column: span 2; 
  background: linear-gradient(145deg, #2e7d32, #1b5e20);
  color: #ffffff;
  font-size: 28px;
  box-shadow: 0 4px 15px rgba(27, 94, 32, 0.3);
}

.btn-key.eq:active {
    background: #1b5e20;
    box-shadow: inset 4px 4px 10px #0a240c;
}

/* Modal & Others */
.modal { display: none; position: fixed !important; z-index: 99999 !important; left: 0; top: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px); pointer-events: auto; }
.modal-content { background: #f5f5f5; color: #333; margin: 5vh auto; width: 92%; max-height: 85vh; border-radius: 25px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.5); position: relative; }
.modal-header { background: #fff; padding: 16px 20px; display: flex; justify-content: space-between; font-weight: 800; border-bottom: 1px solid #ddd; color: #222; }
.archive-list { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 12px; }
.archive-item { background: #fff; padding: 16px; border-radius: 18px; border: 1px solid #eee; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
.archive-time { font-size: 12px; color: #888; font-weight: 700; margin-bottom: 10px; }
.archive-data-row { display: flex; justify-content: space-between; font-size: 16px; margin-bottom: 4px; }
.archive-total-row { border-top: 1px dashed #ddd; margin-top: 10px; padding-top: 8px; font-size: 18px; color: #2e7d32; font-weight: 800; display: flex; justify-content: space-between; }
.caret { display: inline-block; width: 2px; height: 1em; background: #333; margin-left: 2px; vertical-align: middle; animation: blink 1s steps(1) infinite; }
.btn-clear-archive {
  background: #ff8a80;
  color: #b71c1c;
  border: none;
  padding: 4px 12px;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 700;
  cursor: pointer;
  text-transform: uppercase;
}

.btn-clear-archive:active {
  transform: scale(0.9);
  background: #e57373;
}

.btn-close-modal {
  background: transparent;
  border: none;
  font-size: 28px;
  color: #666;
  cursor: pointer;
  line-height: 1;
}

@keyframes blink { 50% { opacity: 0; } }

@media print {
  body { background: white !important; color: black !important; }
  
  /* Hide all UI elements except the history */
  .keys, .action-bar, .total-strip, .modal, .live-preview, .caret, .rotation-overlay { 
    display: none !important; 
  }

  .display-container { 
    background: white !important; 
    border: none; 
    box-shadow: none; 
    display: block; 
    overflow: visible; 
  }

  .history { 
    overflow: visible !important; 
    padding: 0; 
  }

  .h-row { 
    background: white !important; 
    border-bottom: 1px solid #ddd !important; 
    border-radius: 0; 
    margin-bottom: 0; 
    display: flex; 
    justify-content: space-between;
    align-items: flex-start;
    padding: 8px 0;
    height: auto !important; /* Allow row to grow vertically */
    page-break-inside: avoid;
  }

  .h-exp { 
    flex: 1;
    text-align: left !important; 
    white-space: normal !important; /* Remove the nowrap that causes ellipsis */
    overflow: visible !important; 
    text-overflow: clip !important; 
    padding: 0 15px 0 0;
    font-size: 14px;
    color: #333 !important;
  }

  .h-res { 
    flex: 0 0 auto;
    text-align: right !important; 
    white-space: nowrap !important; /* Keep results on one line */
    overflow: visible !important;
    font-size: 14px;
    font-weight: 700;
    color: #000 !important;
  }

  .history::after { 
    content: "GRAND TOTAL: â‚¹" attr(data-total); 
    display: block; 
    text-align: right; 
    font-size: 22px; 
    font-weight: 900; 
    border-top: 2px solid #000; 
    margin-top: 20px; 
    padding-top: 10px;
  }
}

/* Rotation Message Overlay */
.rotation-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: #121212;
  color: #81c784;
  z-index: 100000;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 20px;
}

.rotation-message svg {
  margin-bottom: 20px;
  animation: rotateHint 2s infinite ease-in-out;
}

@keyframes rotateHint {
  0% { transform: rotate(0deg); }
  50% { transform: rotate(-90deg); }
  100% { transform: rotate(0deg); }
}

/* Show only in landscape */
@media (orientation: landscape) {
  .rotation-overlay {
    display: flex;
  }
  }
